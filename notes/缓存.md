## 一、缓存

#### 缓存是什么？

（自己的理解：将一些基本不变的数据存储到内存中，来达到数据加速访问的效果，这就是缓存）

在内存中存储被访问过的数据，供后续访问时使用，以此来达到提速的效果

数据缓存标准：热点数据、静态数据

###### 预读取

即在数据入口处加一道前置的缓冲区：在系统对外部提供服务之前，先将硬盘中的数据加载到内存之中，然后再对外提供服务

对于一启动就面临千万级别的的请求的系统，通过此方式可以缓解数据库压力，如果缓冲还不能解决，可以再考虑横向扩展和负载均衡

###### 延迟写

由于写入数据时有一系列保证数据正确性的机制，所以数据库写入速度慢于读取速度

提高写入速度的方式：分库分表（对跨表操作及多条件组合查询的副作用巨大）、缓存

预先将需要写入到磁盘或数据库的数据，先暂时写入到内存，然后就返回成功，在定时将内存中的数据批量写入到磁盘，使用于对数据完整性要求不太苛刻的场景（如点赞数、参与用户数）

#### 在哪里加缓存

1. 浏览器缓存

   一般用于缓存图片、js、css 等，可通过消息头 Cache-Control 进行控制

2. DNS缓存

   更新缓存的速度较慢，至少是分钟级别，适用于不经常变动的静态数据

3. 网关（代理）缓存

   常用的网关缓存有 Varnish、Squid、Nginx

4. 进程内缓存

5. 进程外缓存

   如 redis、memcached

6. 数据库缓存





## 二、缓存穿透、缓存击穿、缓存雪崩区别和解决方案

#### 缓存穿透

缓存穿透是指缓存和数据库中都没有的数据，而用户不断发起请求，如发起为id为 “-1” 的数据或 id 为特别大不存在的数据。这时的用户很可能是攻击者，攻击会导致数据库压力过大

###### 解决方案

- 接口层增加校验，如用户鉴权校验，id做基础校验，id<=0的直接拦截；
- 从缓存取不到的数据，在数据库中也没有取到，这时也可以将 key-value 对写为 key-null，缓存有效时间可以设置短点，如30秒（设置太长会导致正常情况也没法使用）。这样可以防止攻击用户反复用同一个id暴力攻击

#### 缓存击穿

缓存击穿是指缓存中没有但数据库中有的数据（一般是缓存时间到期），这时由于并发用户特别多，同时读缓存没读到数据，又同时去数据库去取数据，引起数据库压力瞬间增大，造成过大压力

###### 解决方案

- 设置热点数据永不过期
- 加互斥锁（成功获取锁则从数据库中读取数据，失败睡眠一段时间在去从缓存中获取数据）

#### 缓存雪崩

缓存雪崩是指缓存中数据大批量到过期时间，而查询数据量巨大，引起数据库压力过大甚至宕机。和缓存击穿不同的是，缓存击穿指并发查同一条数据，缓存雪崩是不同数据都过期了，很多数据都查不到从而查数据库

###### 解决方案

- 缓存数据的过期时间设置随机，防止同一时间大量数据过期现象发生
- 如果缓存数据库是分布式部署，将热点数据均匀分布在不同的缓存数据库中
- 设置热点数据永远不过期

*参考资料：<https://blog.csdn.net/kongtiao5/article/details/82771694>*





## 三、XSS 攻击

微博之类的内容网站，如果没有对发布的内容进行处理，很容易受到 XSS 攻击的影响。例如任何用户都可以发布以下内容：

```HTML
<script> alert("hello"); </script>	
```

这个脚本会被执行，从而导致其它用户在浏览到该内容时，浏览器弹出一个窗口，影响使用体验。

除此之外，XSS 还可以产生以下危害：

- 窃取用户的 Cookie
- 伪造虚假的输入表单骗取个人信息
- 显示伪造的文章或者图片

防御 XSS 也很容易，只要将 `<` 和 `>` 等字符进行转义即可





## 四、Redis CrackIT 入侵

当使用 root 用户运行 Redis，并且 Redis 未设置密码或者设置为初始密码，那么攻击者很容易登录到 Redis 上，并且使用 config 命令修改 authorized_keys 文件，从而让攻击者无需用户名和密码即可登录。

解决方案是，使用普通用户运行 Redis，并且设置复杂的 Redis 密码