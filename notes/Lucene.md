# Lucene

### 一、概述

###### 数据分类

结构化数据：具有一定格式、长度、数据类型等的数据，如数据库中的数据

非结构化数据：格式、长度等不固定的数据，如 word 文档、html 文件、txt 文件等

###### 数据查询

结构化数据查询：SQL 语句查询

非结构化数据查询： 1.顺序扫描，使用程序将文件读到内存中，进行字符串匹配； 2.将非结构化数据转换为结构化数据，如找出一堆文件中含有某个单词的文件，可先根据空格进行字符串拆分，得到一个单词列表，基于列表创建一个索引，之后通过查询索引找出单词及其所在文件

###### 全文检索

创建索引然后查询索引的过程，创建索引会耗费一定的时间，但创建后可多次使用

### 二、使用场景

搜索引擎：如百度、谷歌

站内搜索：如淘宝、微博

### 三、使用步骤

###### 创建索引

1. 获取文档

   获取原始文档，即要进行搜索的文档，如搜索引擎的原始文档就是互联网上所有的网页，一般通过爬虫获得，站内搜索的原始文档就是数据库中的数据

2. 获取文档对象

   即 document 对象，它通过多个域来保存原始文档数据，类似于键值对形式，如文件路径为 xxx，这就是一个域；每个文档还有一个唯一的编号文档 id

3. 分析文档

   即分词的过程，如以下步骤：根据空格进行字符串拆分，得到一个单词列表；把单词统一转换成大小写；去除标点符号；去除停用词，即无意义的词

   每个关键词都会封装成一个 Term 对象，它包含两部分内容：关键词所在的域和关键词本身；不同域中拆分出的相同的关键词时不同的 Term

4. 创建索引

   基于关键词列表创建一个索引，保存到索引库中，索引库中包含索引、document 对象、关键词和文档的对应关系等，通过词语去找到文档的这种索引结构叫做倒排索引结构

###### 查询索引

1. 提供用户查询接口

   即用户输入查询条件的地方

2. 封装查询对象

   把要查询的域和要搜索的关键词进行封装

3. 执行查询

   根据查询关键词到对应的域上进行搜索，找到关键词，再根据关键词找到对应的文档

4. 渲染结果

   根据文档 id 找到文档对象，对关键词进行高亮显示，分页处理，展示等 

### 四、API

1. Directory 索引库对象

   RAMDirectory 内存索引库

   FSDirectory 磁盘索引库

2. IndexWriter 写索引对象

   IndexWriterConfig 索引配置对象，默认配置对象使用标准分词器

3. IndexReader 读索引对象

4. IndexSearcher 索引搜索对象

5. Field 域对象

   TextField 文本域对象

   LongPoint 

   StoredField

6. Document 文档对象

7. Query 索引查询条件对象

   TermQuery 单词查询

   RangeQuery 范围查询

8. TopDocs 查询结果对象

   totalHits 查询结果总条数

   scoreDocs 查询结果文档列表

9. Analyzer 分词器对象

   StandarAnalyzer 标准分词器

   IKAnalyzer IK 中文分词器

10. TokenStream 

### 五、分词器

1. 标准分词器

2. IK 分词器

   扩展词典(hotword.dic)：可以添加新词，windows 的记事本自带的 `utf-8` 编码方式实际为 `utf-8+BOM` ，勿使用记事本打开词典

   停用词词典(stopword.dic)：无意义的或敏感词汇

### 六、索引库维护

1. 添加索引

2. 删除索引

   可直接删除全部索引或根据查询、关键词删除

3. 更新索引

   原理为查询到索引删除后再进行添加

### 七、索引库查询

1. 根据关键词查询

   使用 TermQuery 对象

2. 根据范围查询

   使用 RangeQuery 对象

3. 根据句子查询

   使用 QueryPaser 对象，先对要查询的内容进行分词，再基于分词的结果进行查询